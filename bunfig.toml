# =============================================================================
# geelark Bun Configuration
# https://bun.sh/docs/runtime/bunfig
# =============================================================================

# -----------------------------------------------------------------------------
# Workspace Configuration
# -----------------------------------------------------------------------------
[workspace]
# workspace = "packages/*"  # Uncomment for monorepo support

# -----------------------------------------------------------------------------
# Install Configuration
# -----------------------------------------------------------------------------
[install]
# Behavior: auto (quiet | verbose | shell) - Controls install output
# default: auto - quiet in CI, verbose otherwise
verbose = false

# Exact package versions (no ^ or ~ in lockfile)
exact = true

# Fail if lockfile needs updating
frozen-lockfile = false

# Optional: cache location
# cache = "/path/to/cache"

# Optional: global install location
# globalDir = "/path/to/global"
# globalBinDir = "/path/to/bin"

# -----------------------------------------------------------------------------
# Scoped Package Registries
# -----------------------------------------------------------------------------
[install.scopes]
# Example: GitHub Packages
# "@your-org" = { token = "$GITHUB_TOKEN", url = "https://npm.pkg.github.com" }

# Example: Private npm registry
# "@your-scope" = { token = "$NPM_TOKEN", url = "https://registry.example.com" }

# Example: Verdaccio
# "@private" = { token = "$VERDACCIO_TOKEN", url = "http://localhost:4873" }

# Dev-HQ scoped packages (template example, customize as needed)
[install.scopes."@dev-hq"]
token = "$DEV_HQ_TOKEN"
url = "https://npm.pkg.github.com/your-org"

# -----------------------------------------------------------------------------
# Lockfile Configuration
# -----------------------------------------------------------------------------
[lockfile]
# Lockfile format: yarn | npm (default: yarn for compatibility)
print = "yarn"

# Save path (default: package.json manifest location)
# savePath = "package.json"

# -----------------------------------------------------------------------------
# Test Configuration
# -----------------------------------------------------------------------------
[test]
# Test root directory
root = "tests"

# Preload scripts (runs before tests)
preload = ["./src/preload/test-setup.ts"]

# Coverage thresholds (when using --coverage)
coverage = true
# coverageThreshold = { statements = 80, branches = 80, functions = 80, lines = 80 }

# Test timeout in milliseconds
timeout = 30000

# Run tests sequentially (true) or in parallel (false, default)
concurrent = false

# Prevent repetitive stack traces in test output
# suppressStackTraces = false

# -----------------------------------------------------------------------------
# Run Configuration
# -----------------------------------------------------------------------------
[run]
# Shell to use for bun run commands
shell = "bun"

# Preload scripts for runtime (not just tests)
# preload = ["./src/preload/global-polyfills.ts"]

# Enable Bun's built-in test runner for bun test
bun = true

# -----------------------------------------------------------------------------
# Build Configuration
# -----------------------------------------------------------------------------
# Build-time constants (dead code elimination via bun:bundle feature())
# [define]
# DEBUG = "true"
# VERSION = "\"1.0.0\""
# API_URL = "\"https://api.example.com\""

# -----------------------------------------------------------------------------
# Loader Configuration
# -----------------------------------------------------------------------------
# Custom file loaders for build time transpilation
# [loader]
# ".toml" = "file"
# ".yaml" = "json"
# ".md" = "jsx"
# ".txt" = "text"

# -----------------------------------------------------------------------------
# Package.json Configuration Override
# -----------------------------------------------------------------------------
# [pkg]
# Override package.json fields for build
# name = "geelark"
# version = "1.0.0"

# -----------------------------------------------------------------------------
# Environment Variables (build-time)
# -----------------------------------------------------------------------------
# These can be referenced via process.env or Bun.env
# [env]
# NODE_ENV = "development"
# BUN_DEBUG = "false"

# -----------------------------------------------------------------------------
# HTTP Client Configuration
# -----------------------------------------------------------------------------
[http]
# User-Agent header for fetch/Bun.fetch
user-agent = "Geelark-Upload/1.0.0 (Bun)"

# Connect timeout in milliseconds
# connectTimeout = 10000

# Read timeout in milliseconds
# readTimeout = 30000

# Enable HTTP keep-alive
# keepAlive = true

# Maximum number of connections to keep alive
# maxKeepAliveRequests = 100

# Keep-alive timeout in milliseconds
# keepAliveTimeout = 60000

# DNS preconnection for faster requests
preconnect = [
  "https://s3.amazonaws.com",
  "https://*.amazonaws.com",
  "https://*.r2.cloudflarestorage.com",
  "https://*.digitaloceanspaces.com",
  "https://*.storage.googleapis.com",
]

# -----------------------------------------------------------------------------
# TLS/HTTPS Configuration
# -----------------------------------------------------------------------------
# [tls]
# Path to CA certificate bundle
# ca = "/path/to/ca-bundle.crt"

# Reject unauthorized TLS certificates
# rejectUnauthorized = true

# Client certificate for mTLS
# cert = "/path/to/client-cert.pem"
# key = "/path/to/client-key.pem"

# -----------------------------------------------------------------------------
# TypeScript Configuration Override
# -----------------------------------------------------------------------------
# [tsconfig]
# Path to custom tsconfig
# path = "./tsconfig.json"

# Override specific compiler options
# [tsconfig.options]
# strict = true
# target = "ES2022"

# -----------------------------------------------------------------------------
# Upload System Configuration
# -----------------------------------------------------------------------------
# Note: bunfig.toml doesn't support custom [upload] sections
# Upload configuration should be done via environment variables or CLI flags

# Upload size limits (for reference)
# maxSimpleSize = 5242880         # 5MB
# maxMultipartSize = 5497558138880 # 5TB
# chunkSize = 5242880             # 5MB

# Upload timeouts (for reference)
# timeout = 300000                 # 5 minutes
# progressInterval = 500          # 500ms
# maxConcurrent = 10              # 10 uploads

# -----------------------------------------------------------------------------
# Upload Build-Time Constants (Feature Flags)
# -----------------------------------------------------------------------------
[define]
# Enable/disable upload features at build time
"process.env.UPLOAD_ENABLED" = "\"true\""
"process.env.UPLOAD_MAX_FILE_SIZE" = "\"5497558138880\""
"process.env.UPLOAD_CHUNK_SIZE" = "\"5242880\""
"process.env.UPLOAD_TIMEOUT" = "\"300000\""

# S3/R2 Provider defaults
"process.env.UPLOAD_PROVIDER" = "\"local\""
"process.env.S3_REGION" = "\"us-east-1\""

# -----------------------------------------------------------------------------
# Feature Flags Configuration
# -----------------------------------------------------------------------------
# Note: Feature flags are enabled via CLI flags, not bunfig.toml
# Enable features: bun run src/index.ts --feature=FEAT_CLOUD_UPLOAD
# Build with features: bun build src/index.ts --feature=FEAT_CLOUD_UPLOAD --feature=FEAT_UPLOAD_PROGRESS
#
# Available features:
#   - FEAT_CLOUD_UPLOAD: Enable S3/R2 cloud uploads
#   - FEAT_UPLOAD_PROGRESS: Real-time progress tracking
#   - FEAT_MULTIPART_UPLOAD: Large file multipart upload
#   - FEAT_UPLOAD_ANALYTICS: Upload metrics and analytics
#   - FEAT_CUSTOM_METADATA: Custom S3 metadata
#
# Usage in code:
#   import { feature } from "bun:bundle";
#   if (feature("FEAT_CLOUD_UPLOAD")) {
#     // This code only included if feature is enabled
#   }

# -----------------------------------------------------------------------------
# Upload Preload Configuration
# -----------------------------------------------------------------------------
# Note: Preload files should be specified via CLI flags or environment variables
# bunfig.toml doesn't support the [preload] section format
# Use: bun --preload ./src/server/UploadService.ts run src/index.ts

# -----------------------------------------------------------------------------
# Environment-Specific Configuration
# -----------------------------------------------------------------------------
# Note: These should be set via environment variables or CLI flags
# bunfig.toml doesn't support nested [env.*] sections

# Development: local uploads with verbose logging
# provider = "local"
# logLevel = "debug"
# enableProfiling = "true"

# Production: S3/R2 with optimized settings
# provider = "s3"
# logLevel = "info"
# enableProfiling = "false"

# Staging: R2 with debugging enabled
# provider = "r2"
# logLevel = "debug"
# enableProfiling = "true"
